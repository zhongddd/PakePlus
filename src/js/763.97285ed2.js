"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[763],{653:function(e,a,l){l.d(a,{BL:function(){return p},Cb:function(){return s},dP:function(){return o},gw:function(){return r},zZ:function(){return i}});var t=l(635);const o={getShops:()=>t.A.get("/api/shops"),addShop:e=>t.A.post("/api/shops",e),getShop:e=>t.A.get(`/api/shops/${e}`),updateShop:(e,a)=>t.A.put(`/api/shops/${e}`,a),deleteShop:e=>t.A.delete(`/api/shops/${e}`),queryShopInfo:e=>t.A.post(`/api/shops/${e}/query`),getShopAuthorize:e=>t.A.get(`/api/shops/${e}/authorize`)},s={getCategories:()=>t.A.get("/api/image-categories"),addCategory:e=>t.A.post("/api/image-categories",e),deleteCategory:(e,a={})=>t.A.delete(`/api/image-categories/${e}`,{params:a})},r={getImages:e=>t.A.get("/api/images",{params:e}),uploadImage:e=>t.A.post("/api/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),compressImage:e=>t.A.post("/api/images/compress",{imageId:e})},p={generateDescription:(e,a={})=>t.A.post("/api/descriptions/generate",{keywords:e},a),generateDescriptionAsync:(e,a={})=>t.A.post("/api/descriptions/generate",{keywords:e,useAsyncMode:!0},a),checkAsyncResult:(e,a,l={})=>t.A.get(`/api/descriptions/async-result/${e}/${a}`,l)},i={getStats:()=>t.A.get("/api/dashboard")}},5763:function(e,a,l){l.r(a),l.d(a,{default:function(){return v}});var t=l(641),o=l(33);const s={class:"shops-container"},r={class:"card-header"},p={class:"dialog-footer"},i={key:0,class:"query-loading"},n={key:1,class:"query-error"},d={key:2},u={key:1,class:"query-count"};function c(e,a,l,c,m,h){const _=(0,t.g2)("el-button"),g=(0,t.g2)("el-table-column"),y=(0,t.g2)("el-table"),k=(0,t.g2)("el-card"),b=(0,t.g2)("el-input"),f=(0,t.g2)("el-form-item"),v=(0,t.g2)("el-form"),F=(0,t.g2)("el-dialog"),w=(0,t.g2)("el-skeleton"),S=(0,t.g2)("el-alert"),A=(0,t.g2)("el-tag"),V=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.bF)(k,null,{header:(0,t.k6)(()=>[(0,t.Lk)("div",r,[a[9]||(a[9]=(0,t.Lk)("span",null,"店铺列表",-1)),(0,t.bF)(_,{type:"primary",onClick:a[0]||(a[0]=e=>c.dialogVisible=!0)},{default:(0,t.k6)(()=>a[8]||(a[8]=[(0,t.eW)("添加店铺")])),_:1,__:[8]})])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(y,{data:c.shops,style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(g,{prop:"shop_name",label:"店铺名称",width:"180"}),(0,t.bF)(g,{prop:"seller_id",label:"卖家ID",width:"180"}),(0,t.bF)(g,{prop:"app_key",label:"AppKey",width:"180"},{default:(0,t.k6)(e=>[(0,t.Lk)("span",null,(0,o.v_)(c.maskText(e.row.app_key)),1)]),_:1}),(0,t.bF)(g,{prop:"created_at",label:"创建时间"}),(0,t.bF)(g,{label:"操作",width:"200"},{default:(0,t.k6)(e=>[(0,t.bF)(_,{size:"small",type:"success",onClick:a=>c.queryShop(e.row)},{default:(0,t.k6)(()=>a[10]||(a[10]=[(0,t.eW)("查询")])),_:2,__:[10]},1032,["onClick"]),(0,t.bF)(_,{size:"small",type:"primary",onClick:a=>c.editShop(e.row)},{default:(0,t.k6)(()=>a[11]||(a[11]=[(0,t.eW)("编辑")])),_:2,__:[11]},1032,["onClick"]),(0,t.bF)(_,{size:"small",type:"danger",onClick:a=>c.confirmDeleteShop(e.row)},{default:(0,t.k6)(()=>a[12]||(a[12]=[(0,t.eW)("删除")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[V,c.loading]])]),_:1}),(0,t.bF)(F,{modelValue:c.dialogVisible,"onUpdate:modelValue":a[6]||(a[6]=e=>c.dialogVisible=e),title:c.isEdit?"编辑店铺":"添加店铺",width:"500px"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",p,[(0,t.bF)(_,{onClick:a[5]||(a[5]=e=>c.dialogVisible=!1)},{default:(0,t.k6)(()=>a[16]||(a[16]=[(0,t.eW)("取消")])),_:1,__:[16]}),(0,t.bF)(_,{type:"primary",onClick:c.submitShopForm,loading:c.submitting},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.eW)("确定")])),_:1,__:[17]},8,["onClick","loading"])])]),default:(0,t.k6)(()=>[(0,t.bF)(v,{model:c.shopForm,"label-width":"100px",rules:c.rules,ref:"shopFormRef"},{default:(0,t.k6)(()=>[(0,t.bF)(f,{label:"店铺名称",prop:"shop_name"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{modelValue:c.shopForm.shop_name,"onUpdate:modelValue":a[1]||(a[1]=e=>c.shopForm.shop_name=e),placeholder:"请输入店铺名称"},null,8,["modelValue"])]),_:1}),(0,t.bF)(f,{label:"卖家ID",prop:"seller_id"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{modelValue:c.shopForm.seller_id,"onUpdate:modelValue":a[2]||(a[2]=e=>c.shopForm.seller_id=e),placeholder:"请输入卖家ID"},null,8,["modelValue"]),a[13]||(a[13]=(0,t.Lk)("div",{class:"form-tip"},"注：商务对接时必填",-1))]),_:1,__:[13]}),(0,t.bF)(f,{label:"AppKey",prop:"app_key"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{modelValue:c.shopForm.app_key,"onUpdate:modelValue":a[3]||(a[3]=e=>c.shopForm.app_key=e),placeholder:"请输入AppKey"},null,8,["modelValue"]),a[14]||(a[14]=(0,t.Lk)("div",{class:"form-tip"},"注：闲鱼开放平台提供的应用KEY",-1))]),_:1,__:[14]}),(0,t.bF)(f,{label:"AppSecret",prop:"app_secret"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{modelValue:c.shopForm.app_secret,"onUpdate:modelValue":a[4]||(a[4]=e=>c.shopForm.app_secret=e),placeholder:"请输入AppSecret",type:"password","show-password":""},null,8,["modelValue"]),a[15]||(a[15]=(0,t.Lk)("div",{class:"form-tip"},"注：闲鱼开放平台提供的应用密钥",-1))]),_:1,__:[15]})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),(0,t.bF)(F,{modelValue:c.queryDialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>c.queryDialogVisible=e),title:"闲鱼店铺信息",width:"700px"},{default:(0,t.k6)(()=>[c.queryLoading?((0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(w,{rows:5,animated:""})])):c.queryError?((0,t.uX)(),(0,t.CE)("div",n,[(0,t.bF)(S,{title:"查询失败",type:"error",description:c.queryError,"show-icon":""},null,8,["description"])])):((0,t.uX)(),(0,t.CE)("div",d,[c.queryResult.shops&&c.queryResult.shops.length>0?((0,t.uX)(),(0,t.Wv)(S,{key:0,title:"查询成功",type:"success",description:"已成功获取闲鱼店铺授权信息","show-icon":"",closable:!1,style:{"margin-bottom":"15px"}})):(0,t.Q3)("",!0),c.queryResult.total>1?((0,t.uX)(),(0,t.CE)("p",u," 发现 "+(0,o.v_)(c.queryResult.total)+" 个授权店铺 ",1)):(0,t.Q3)("",!0),(0,t.bF)(y,{data:c.queryResult.shops,border:"",style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(g,{prop:"shop_name",label:"店铺名称","min-width":"120"}),(0,t.bF)(g,{prop:"user_name",label:"会员名","min-width":"120"}),(0,t.bF)(g,{prop:"user_nick",label:"昵称","min-width":"120"}),(0,t.bF)(g,{prop:"is_pro",label:"鱼小铺"},{default:(0,t.k6)(e=>[(0,t.bF)(A,{type:e.row.is_pro?"success":"info"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(e.row.is_pro?"已开通":"未开通"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(g,{prop:"is_valid",label:"订购状态"},{default:(0,t.k6)(e=>[(0,t.bF)(A,{type:e.row.is_valid?"success":"danger"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(e.row.is_valid?"有效":"无效"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(g,{prop:"valid_end_time",label:"有效期"},{default:(0,t.k6)(e=>[(0,t.eW)((0,o.v_)(c.formatTimestamp(e.row.valid_end_time)),1)]),_:1})]),_:1},8,["data"])]))]),_:1},8,["modelValue"])])}var m=l(953),h=l(163),_=l(7918),g=l(653);const y=new Event("shop-auth-updated");var k={name:"ShopsPage",setup(){const e=(0,m.KR)(!1),a=(0,m.KR)([]),l=(0,m.KR)(!1),o=(0,m.KR)(!1),s=(0,m.KR)(null),r=(0,m.KR)(!1),p=(0,m.KR)(null),i=(0,m.KR)(!1),n=(0,m.KR)(!1),d=(0,m.KR)(""),u=(0,m.KR)({}),c=(0,m.Kh)({shop_name:"",seller_id:"",app_key:"",app_secret:""}),k={shop_name:[{required:!0,message:"请输入店铺名称",trigger:"blur"}],app_key:[{required:!0,message:"请输入AppKey",trigger:"blur"}],app_secret:[{required:!0,message:"请输入AppSecret",trigger:"blur"}]},b=async()=>{e.value=!0;try{const e=await g.dP.getShops();a.value=Array.isArray(e.data.data)?e.data.data:[]}catch(l){console.error("获取店铺列表失败:",l),h.nk.error("获取店铺列表失败"),a.value=[]}finally{e.value=!1}},f=()=>{c.shop_name="",c.seller_id="",c.app_key="",c.app_secret="",s.value=null},v=e=>{o.value=!0,s.value=e.id,c.shop_name=e.shop_name,c.seller_id=e.seller_id,c.app_key=e.app_key,c.app_secret="",l.value=!0},F=async()=>{if(p.value)try{await p.value.validate(),r.value=!0;const e={app_key:c.app_key,app_secret:c.app_secret,shop_name:c.shop_name,seller_id:c.seller_id};await g.dP.addShop(e),h.nk.success("店铺添加成功"),l.value=!1,f(),b()}catch(e){console.error("添加店铺失败:",e),h.nk.error(e.response?.data?.message||"添加店铺失败")}finally{r.value=!1}},w=async()=>{if(p.value)try{await p.value.validate(),r.value=!0;const e={app_key:c.app_key,app_secret:c.app_secret,shop_name:c.shop_name,seller_id:c.seller_id};await g.dP.updateShop(s.value,e),h.nk.success("店铺更新成功"),l.value=!1,b()}catch(e){console.error("更新店铺失败:",e),h.nk.error(e.response?.data?.message||"更新店铺失败")}finally{r.value=!1}},S=e=>{_.s.confirm(`确定要删除店铺 "${e.shop_name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A(e.id)}).catch(()=>{})},A=async e=>{try{await _.s.confirm("删除店铺将会同时删除相关的发布计划，确定要删除吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.dP.deleteShop(e),h.nk.success("店铺删除成功"),b()}catch(a){"cancel"!==a&&(console.error("删除店铺失败:",a),h.nk.error(a.response?.data?.message||"删除店铺失败"))}},V=e=>{if(!e||0===e)return"无";const a=new Date(1e3*e);return a.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},q=async e=>{i.value=!0,n.value=!0,d.value="",u.value={};try{const a=await g.dP.queryShopInfo(e.id);h.nk.success("店铺信息查询成功"),u.value=a.data.data,u.value.shops&&u.value.shops.length>0&&(localStorage.setItem("authorizedShops",JSON.stringify(u.value.shops)),window.dispatchEvent(y),h.nk.success("授权店铺信息已保存，可在快速发布页面中使用"))}catch(a){console.error("查询店铺信息失败:",a),d.value=a.response?.data?.message||"查询店铺信息失败"}finally{n.value=!1}},C=e=>e?e.length<=4?e:e.substring(0,4)+"****"+e.substring(e.length-4):"",R=()=>{o.value?w():F()};return(0,t.sV)(()=>{b()}),{loading:e,shops:a,dialogVisible:l,isEdit:o,shopForm:c,rules:k,submitting:r,shopFormRef:p,queryDialogVisible:i,queryLoading:n,queryError:d,queryResult:u,editShop:v,addShop:F,updateShop:w,confirmDeleteShop:S,deleteShop:A,queryShop:q,maskText:C,formatTimestamp:V,submitShopForm:R}}},b=l(6262);const f=(0,b.A)(k,[["render",c],["__scopeId","data-v-080b34bf"]]);var v=f}}]);
//# sourceMappingURL=763.97285ed2.js.map