"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[747],{116:function(e,a,t){var l=t(6518),r=t(9565),o=t(2652),i=t(9306),n=t(8551),s=t(1767),c=t(9539),d=t(4549),u=d("find",TypeError);l({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(e){n(this);try{i(e)}catch(l){c(this,"throw",l)}if(u)return r(u,this,e);var a=s(this),t=0;return o(a,function(a,l){if(e(a,t++))return l(a)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},653:function(e,a,t){t.d(a,{BL:function(){return n},Cb:function(){return o},dP:function(){return r},gw:function(){return i},zZ:function(){return s}});var l=t(635);const r={getShops:()=>l.A.get("/api/shops"),addShop:e=>l.A.post("/api/shops",e),getShop:e=>l.A.get(`/api/shops/${e}`),updateShop:(e,a)=>l.A.put(`/api/shops/${e}`,a),deleteShop:e=>l.A.delete(`/api/shops/${e}`),queryShopInfo:e=>l.A.post(`/api/shops/${e}/query`),getShopAuthorize:e=>l.A.get(`/api/shops/${e}/authorize`)},o={getCategories:()=>l.A.get("/api/image-categories"),addCategory:e=>l.A.post("/api/image-categories",e),deleteCategory:(e,a={})=>l.A.delete(`/api/image-categories/${e}`,{params:a})},i={getImages:e=>l.A.get("/api/images",{params:e}),uploadImage:e=>l.A.post("/api/images/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),compressImage:e=>l.A.post("/api/images/compress",{imageId:e})},n={generateDescription:(e,a={})=>l.A.post("/api/descriptions/generate",{keywords:e},a),generateDescriptionAsync:(e,a={})=>l.A.post("/api/descriptions/generate",{keywords:e,useAsyncMode:!0},a),checkAsyncResult:(e,a,t={})=>l.A.get(`/api/descriptions/async-result/${e}/${a}`,t)},s={getStats:()=>l.A.get("/api/dashboard")}},684:function(e){e.exports=function(e,a){var t="function"==typeof Iterator&&Iterator.prototype[e];if(t)try{t.call({next:null},a).next()}catch(l){return!0}}},1385:function(e,a,t){var l=t(9539);e.exports=function(e,a,t){for(var r=e.length-1;r>=0;r--)if(void 0!==e[r])try{t=l(e[r].iterator,a,t)}catch(o){a="throw",t=o}if("throw"===a)throw t;return t}},2489:function(e,a,t){var l=t(6518),r=t(9565),o=t(9306),i=t(8551),n=t(1767),s=t(9462),c=t(6319),d=t(6395),u=t(9539),g=t(684),p=t(4549),f=!d&&!g("filter",function(){}),m=!d&&!f&&p("filter",TypeError),k=d||f||m,v=s(function(){var e,a,t,l=this.iterator,o=this.predicate,n=this.next;while(1){if(e=i(r(n,l)),a=this.done=!!e.done,a)return;if(t=e.value,c(l,o,[t,this.counter++],!0))return t}});l({target:"Iterator",proto:!0,real:!0,forced:k},{filter:function(e){i(this);try{o(e)}catch(a){u(this,"throw",a)}return m?r(m,this,e):new v(n(this),{predicate:e})}})},2529:function(e){e.exports=function(e,a){return{value:e,done:a}}},2747:function(e,a,t){t.r(a),t.d(a,{default:function(){return we}});t(8111),t(2489);var l=t(641),r=t(33),o=t(3751);const i={class:"images-page"},n={class:"page-header"},s={class:"header-actions"},c={class:"filter-content"},d={class:"filter-actions"},u={class:"category-actions"},g={class:"upload-section"},p={class:"section-header"},f={class:"upload-content"},m={class:"category-tags"},k={class:"image-gallery"},v={key:1,class:"image-grid"},y={class:"image-card"},h={class:"image-wrapper"},b=["src","alt","onClick"],_={class:"image-overlay"},w={class:"image-actions"},F={class:"image-info"},C=["title"],I={class:"image-meta"},L={class:"meta-item"},U={class:"meta-item"},R={class:"pagination-container"},V={class:"preview-header"},x={class:"preview-title"},A={class:"preview-actions"},D={class:"preview-content"},W={class:"preview-image-container"},E=["src"],K={class:"preview-sidebar"},P={class:"preview-info-card"},S={class:"info-list"},z={class:"info-item"},T={class:"info-value"},X={class:"info-item"},B={class:"info-value"},$={class:"info-item"},G={class:"info-value"},H={class:"info-item"},N={class:"info-value"},Q={class:"info-item"},j={class:"info-value"},O={class:"preview-url-card"};function M(e,a,t,M,q,J){const Z=(0,l.g2)("RefreshIcon"),Y=(0,l.g2)("el-icon"),ee=(0,l.g2)("el-button"),ae=(0,l.g2)("Filter"),te=(0,l.g2)("el-badge"),le=(0,l.g2)("el-option"),re=(0,l.g2)("el-select"),oe=(0,l.g2)("el-form-item"),ie=(0,l.g2)("el-form"),ne=(0,l.g2)("el-divider"),se=(0,l.g2)("Delete"),ce=(0,l.g2)("el-popover"),de=(0,l.g2)("ArrowUp"),ue=(0,l.g2)("ArrowDown"),ge=(0,l.g2)("ImageUploader"),pe=(0,l.g2)("el-tag"),fe=(0,l.g2)("Picture"),me=(0,l.g2)("el-empty"),ke=(0,l.g2)("View"),ve=(0,l.g2)("Download"),ye=(0,l.g2)("Document"),he=(0,l.g2)("el-pagination"),be=(0,l.g2)("DocumentCopy"),_e=(0,l.g2)("Close"),we=(0,l.g2)("el-input"),Fe=(0,l.g2)("el-dialog"),Ce=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",n,[a[16]||(a[16]=(0,l.Lk)("h1",null,"图片管理",-1)),(0,l.Lk)("div",s,[(0,l.bF)(ee,{type:"primary",onClick:M.refreshImages,class:"apple-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(Z)]),_:1}),a[9]||(a[9]=(0,l.eW)(" 刷新 "))]),_:1,__:[9]},8,["onClick"]),(0,l.bF)(ce,{placement:"bottom-end",width:300,trigger:"click","popper-class":"filter-popover"},{reference:(0,l.k6)(()=>[(0,l.bF)(ee,{class:(0,r.C4)(["filter-btn",{"is-active":M.hasActiveFilters}])},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(ae)]),_:1}),a[10]||(a[10]=(0,l.Lk)("span",null,"筛选",-1)),M.hasActiveFilters?((0,l.uX)(),(0,l.Wv)(te,{key:0,value:1,class:"filter-badge"})):(0,l.Q3)("",!0)]),_:1,__:[10]},8,["class"])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",c,[a[15]||(a[15]=(0,l.Lk)("h4",{class:"filter-title"},"筛选图片",-1)),(0,l.bF)(ie,{model:M.filter},{default:(0,l.k6)(()=>[(0,l.bF)(oe,{label:"分类"},{default:(0,l.k6)(()=>[(0,l.bF)(re,{modelValue:M.filter.categoryId,"onUpdate:modelValue":a[0]||(a[0]=e=>M.filter.categoryId=e),placeholder:"全部分类",clearable:"",class:"full-width"},{default:(0,l.k6)(()=>[(0,l.bF)(le,{label:"全部分类",value:""}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(M.categories,e=>((0,l.uX)(),(0,l.Wv)(le,{key:e.id,label:`${e.name} (${e.image_count})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,l.Lk)("div",d,[(0,l.bF)(ee,{type:"primary",onClick:M.filterImages},{default:(0,l.k6)(()=>a[11]||(a[11]=[(0,l.eW)("应用筛选")])),_:1,__:[11]},8,["onClick"]),(0,l.bF)(ee,{onClick:M.resetFilter,plain:""},{default:(0,l.k6)(()=>a[12]||(a[12]=[(0,l.eW)("重置")])),_:1,__:[12]},8,["onClick"])])]),_:1},8,["model"]),(0,l.bF)(ne),(0,l.Lk)("div",u,[a[14]||(a[14]=(0,l.Lk)("h4",{class:"filter-title"},"分类管理",-1)),(0,l.bF)(ee,{type:"danger",onClick:M.confirmDeleteCategory,disabled:!M.filter.categoryId,class:"delete-category-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(se)]),_:1}),a[13]||(a[13]=(0,l.eW)(" 删除当前分类 "))]),_:1,__:[13]},8,["onClick","disabled"])])])]),_:1})])]),(0,l.Lk)("div",g,[(0,l.Lk)("div",p,[a[17]||(a[17]=(0,l.Lk)("h2",null,"上传图片",-1)),(0,l.bF)(ee,{onClick:a[1]||(a[1]=e=>M.isUploadVisible=!M.isUploadVisible),class:(0,r.C4)(["toggle-btn",{"is-active":M.isUploadVisible}])},{default:(0,l.k6)(()=>[M.isUploadVisible?((0,l.uX)(),(0,l.Wv)(Y,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(de)]),_:1})):((0,l.uX)(),(0,l.Wv)(Y,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(ue)]),_:1})),(0,l.eW)(" "+(0,r.v_)(M.isUploadVisible?"收起":"展开"),1)]),_:1},8,["class"])]),(0,l.bo)((0,l.Lk)("div",f,[(0,l.bF)(ge,{onUploadSuccess:M.handleUploadSuccess},null,8,["onUploadSuccess"])],512),[[o.aG,M.isUploadVisible]])]),(0,l.Lk)("div",m,[(0,l.bF)(pe,{effect:""===M.filter.categoryId?"dark":"plain",class:"category-tag",onClick:a[2]||(a[2]=e=>M.selectCategory(""))},{default:(0,l.k6)(()=>a[18]||(a[18]=[(0,l.eW)(" 全部图片 ")])),_:1,__:[18]},8,["effect"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(M.categories,e=>((0,l.uX)(),(0,l.Wv)(pe,{key:e.id,effect:M.filter.categoryId===e.id?"dark":"plain",class:"category-tag",onClick:a=>M.selectCategory(e.id)},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(e.name)+" ("+(0,r.v_)(e.image_count)+") ",1)]),_:2},1032,["effect","onClick"]))),128))]),(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",k,[0===M.images.length?((0,l.uX)(),(0,l.Wv)(me,{key:0,description:"暂无图片"},{image:(0,l.k6)(()=>[(0,l.bF)(Y,{class:"empty-icon"},{default:(0,l.k6)(()=>[(0,l.bF)(fe)]),_:1})]),default:(0,l.k6)(()=>[(0,l.bF)(ee,{type:"primary",onClick:a[3]||(a[3]=e=>M.isUploadVisible=!0)},{default:(0,l.k6)(()=>a[19]||(a[19]=[(0,l.eW)("上传图片")])),_:1,__:[19]})]),_:1})):((0,l.uX)(),(0,l.CE)("div",v,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(M.images,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"image-item"},[(0,l.Lk)("div",y,[(0,l.Lk)("div",h,[(0,l.Lk)("img",{src:e.url,alt:e.original_name,class:"image",onClick:a=>M.handlePreviewImage(e)},null,8,b),(0,l.Lk)("div",_,[(0,l.Lk)("div",w,[(0,l.bF)(ee,{circle:"",size:"small",type:"primary",onClick:a=>M.handlePreviewImage(e),class:"action-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(ke)]),_:1})]),_:2},1032,["onClick"]),e.compressed?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(ee,{key:0,circle:"",size:"small",type:"warning",onClick:a=>M.compressImage(e),loading:M.compressingId===e.id,class:"action-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(ve)]),_:1})]),_:2},1032,["onClick","loading"])),(0,l.bF)(ee,{circle:"",size:"small",type:"danger",onClick:a=>M.confirmDelete(e),class:"action-btn"},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(se)]),_:1})]),_:2},1032,["onClick"])])]),e.compressed?((0,l.uX)(),(0,l.Wv)(pe,{key:0,size:"small",type:"success",class:"image-tag"},{default:(0,l.k6)(()=>a[20]||(a[20]=[(0,l.eW)("已压缩")])),_:1,__:[20]})):(0,l.Q3)("",!0)]),(0,l.Lk)("div",F,[(0,l.Lk)("div",{class:"image-name",title:e.original_name},(0,r.v_)(e.original_name),9,C),(0,l.Lk)("div",I,[(0,l.Lk)("div",L,[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(ye)]),_:1}),(0,l.Lk)("span",null,(0,r.v_)(M.formatSize(e.size)),1)]),(0,l.Lk)("div",U,[(0,l.bF)(pe,{size:"small",effect:"plain"},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(M.getCategoryName(e.category_id)),1)]),_:2},1024)])])])])]))),128))])),(0,l.Lk)("div",R,[(0,l.bF)(he,{"current-page":M.pagination.page,"onUpdate:currentPage":a[4]||(a[4]=e=>M.pagination.page=e),"page-size":M.pagination.limit,"onUpdate:pageSize":a[5]||(a[5]=e=>M.pagination.limit=e),"page-sizes":[12,24,36,48],layout:"total, sizes, prev, pager, next, jumper",total:M.pagination.total,onSizeChange:M.handleSizeChange,onCurrentChange:M.handlePageChange,background:""},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])),[[Ce,M.loading]]),(0,l.bF)(Fe,{modelValue:M.previewVisible,"onUpdate:modelValue":a[8]||(a[8]=e=>M.previewVisible=e),width:"auto",fullscreen:"",class:"preview-dialog","append-to-body":!0},{header:(0,l.k6)(()=>[(0,l.Lk)("div",V,[(0,l.Lk)("div",x,[(0,l.Lk)("h3",null,(0,r.v_)(M.previewImage?.original_name),1),M.previewImage?.compressed?((0,l.uX)(),(0,l.Wv)(pe,{key:0,type:"success",effect:"plain"},{default:(0,l.k6)(()=>a[21]||(a[21]=[(0,l.eW)("已压缩")])),_:1,__:[21]})):(0,l.Q3)("",!0)]),(0,l.Lk)("div",A,[(0,l.bF)(ee,{onClick:M.copyUrl,type:"primary",plain:""},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(be)]),_:1}),a[22]||(a[22]=(0,l.eW)(" 复制链接 "))]),_:1,__:[22]},8,["onClick"]),(0,l.bF)(ee,{onClick:a[6]||(a[6]=e=>M.previewVisible=!1),circle:""},{default:(0,l.k6)(()=>[(0,l.bF)(Y,null,{default:(0,l.k6)(()=>[(0,l.bF)(_e)]),_:1})]),_:1})])])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",D,[(0,l.Lk)("div",W,[(0,l.Lk)("img",{src:M.previewUrl,alt:"预览图片",class:"preview-image"},null,8,E)]),(0,l.Lk)("div",K,[(0,l.Lk)("div",P,[a[28]||(a[28]=(0,l.Lk)("h4",null,"图片信息",-1)),(0,l.Lk)("div",S,[(0,l.Lk)("div",z,[a[23]||(a[23]=(0,l.Lk)("div",{class:"info-label"},"文件名",-1)),(0,l.Lk)("div",T,(0,r.v_)(M.previewImage?.original_name),1)]),(0,l.Lk)("div",X,[a[24]||(a[24]=(0,l.Lk)("div",{class:"info-label"},"大小",-1)),(0,l.Lk)("div",B,(0,r.v_)(M.formatSize(M.previewImage?.size)),1)]),(0,l.Lk)("div",$,[a[25]||(a[25]=(0,l.Lk)("div",{class:"info-label"},"尺寸",-1)),(0,l.Lk)("div",G,(0,r.v_)(M.previewImage?.width||"未知")+" x "+(0,r.v_)(M.previewImage?.height||"未知"),1)]),(0,l.Lk)("div",H,[a[26]||(a[26]=(0,l.Lk)("div",{class:"info-label"},"上传时间",-1)),(0,l.Lk)("div",N,(0,r.v_)(M.formatDate(M.previewImage?.created_at)),1)]),(0,l.Lk)("div",Q,[a[27]||(a[27]=(0,l.Lk)("div",{class:"info-label"},"分类",-1)),(0,l.Lk)("div",j,(0,r.v_)(M.getCategoryName(M.previewImage?.category_id)),1)])])]),(0,l.Lk)("div",O,[a[29]||(a[29]=(0,l.Lk)("h4",null,"图片链接",-1)),(0,l.bF)(we,{modelValue:M.previewUrl,"onUpdate:modelValue":a[7]||(a[7]=e=>M.previewUrl=e),readonly:"",class:"url-input"},null,8,["modelValue"])])])])]),_:1},8,["modelValue"])])}t(116);var q=t(953),J=t(163),Z=t(7918),Y=t(8548),ee=t(653);const ae={class:"image-uploader"},te={class:"category-select"},le={class:"upload-container"},re={class:"upload-drag-area"},oe={key:0,class:"upload-controls"},ie={class:"url-input"},ne={key:0,class:"url-preview"},se={class:"url-preview-image"},ce=["src"],de={class:"upload-controls",style:{"margin-top":"10px"}},ue={class:"preview-dialog-content"},ge=["src"],pe={class:"dialog-footer"};function fe(e,a,t,r,o,i){const n=(0,l.g2)("el-option"),s=(0,l.g2)("el-select"),c=(0,l.g2)("PlusIcon"),d=(0,l.g2)("el-icon"),u=(0,l.g2)("el-button"),g=(0,l.g2)("DeleteIcon"),p=(0,l.g2)("el-form-item"),f=(0,l.g2)("Upload"),m=(0,l.g2)("el-radio-button"),k=(0,l.g2)("Link"),v=(0,l.g2)("el-radio-group"),y=(0,l.g2)("el-upload"),h=(0,l.g2)("el-input"),b=(0,l.g2)("el-form"),_=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",ae,[(0,l.bF)(b,{model:r.form,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)(p,{label:"图片分类"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",te,[(0,l.bF)(s,{modelValue:r.form.categoryId,"onUpdate:modelValue":a[0]||(a[0]=e=>r.form.categoryId=e),placeholder:"选择图片分类",style:{width:"200px"}},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.categories,e=>((0,l.uX)(),(0,l.Wv)(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,l.bF)(u,{type:"primary",size:"small",onClick:a[1]||(a[1]=e=>r.showCategoryDialog=!0)},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(c)]),_:1}),a[10]||(a[10]=(0,l.eW)(" 添加分类 "))]),_:1,__:[10]}),(0,l.bF)(u,{type:"danger",size:"small",onClick:r.confirmDeleteCategory,disabled:!r.form.categoryId||!r.canDeleteCategory(r.form.categoryId)},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(g)]),_:1}),a[11]||(a[11]=(0,l.eW)(" 删除分类 "))]),_:1,__:[11]},8,["onClick","disabled"])])]),_:1}),(0,l.bF)(p,{label:"上传方式"},{default:(0,l.k6)(()=>[(0,l.bF)(v,{modelValue:r.uploadType,"onUpdate:modelValue":a[2]||(a[2]=e=>r.uploadType=e)},{default:(0,l.k6)(()=>[(0,l.bF)(m,{value:"file"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(f)]),_:1}),a[12]||(a[12]=(0,l.eW)(" 上传文件 "))]),_:1,__:[12]}),(0,l.bF)(m,{value:"url"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(k)]),_:1}),a[13]||(a[13]=(0,l.eW)(" 网络图片 "))]),_:1,__:[13]})]),_:1},8,["modelValue"])]),_:1}),"file"===r.uploadType?((0,l.uX)(),(0,l.Wv)(p,{key:0,label:"本地图片"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",le,[(0,l.bF)(y,{ref:"uploadRef",action:r.uploadUrl,headers:r.uploadHeaders,data:r.uploadData,name:"image","on-preview":r.handlePreview,"on-remove":r.handleRemove,"on-success":r.handleSuccess,"on-error":r.handleError,"before-upload":r.beforeUpload,"auto-upload":!0,multiple:"",limit:10,"list-type":"picture-card","on-exceed":r.handleExceed,drag:""},{default:(0,l.k6)(()=>[(0,l.Lk)("div",re,[(0,l.bF)(d,{class:"upload-icon"},{default:(0,l.k6)(()=>[(0,l.bF)(c)]),_:1}),a[14]||(a[14]=(0,l.Lk)("div",{class:"upload-text"},"点击或拖拽图片到此处上传",-1)),a[15]||(a[15]=(0,l.Lk)("div",{class:"el-upload__tip"}," 支持JPG/PNG/GIF格式，单个文件不超过5MB，最多10张 ",-1))])]),_:1},8,["action","headers","data","on-preview","on-remove","on-success","on-error","before-upload","on-exceed"]),r.fileList.length>0?((0,l.uX)(),(0,l.CE)("div",oe,[(0,l.bF)(u,{type:"primary",onClick:r.submitUpload},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(f)]),_:1}),a[16]||(a[16]=(0,l.eW)(" 批量上传 "))]),_:1,__:[16]},8,["onClick"]),(0,l.bF)(u,{onClick:r.clearUpload},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(g)]),_:1}),a[17]||(a[17]=(0,l.eW)(" 清空 "))]),_:1,__:[17]},8,["onClick"])])):(0,l.Q3)("",!0)])]),_:1})):(0,l.Q3)("",!0),"url"===r.uploadType?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.bF)(p,{label:"图片URL"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",ie,[(0,l.bF)(h,{modelValue:r.form.imageUrl,"onUpdate:modelValue":a[3]||(a[3]=e=>r.form.imageUrl=e),placeholder:"请输入图片URL地址",clearable:"",style:{width:"400px"}},{prefix:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(k)]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(u,{type:"primary",onClick:r.uploadByUrl,loading:r.uploading},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(f)]),_:1}),a[18]||(a[18]=(0,l.eW)(" 上传 "))]),_:1,__:[18]},8,["onClick","loading"])]),r.form.imageUrl?((0,l.uX)(),(0,l.CE)("div",ne,[a[19]||(a[19]=(0,l.Lk)("div",{class:"url-preview-label"},"URL预览:",-1)),(0,l.Lk)("div",se,[(0,l.Lk)("img",{src:r.form.imageUrl,alt:"URL预览"},null,8,ce)])])):(0,l.Q3)("",!0),a[20]||(a[20]=(0,l.Lk)("div",{class:"el-upload__tip"}," 支持JPG/PNG/GIF格式，支持批量上传（每行一个URL） ",-1))]),_:1,__:[20]}),(0,l.bF)(p,{label:"批量URL"},{default:(0,l.k6)(()=>[(0,l.bF)(h,{modelValue:r.form.batchUrls,"onUpdate:modelValue":a[4]||(a[4]=e=>r.form.batchUrls=e),type:"textarea",rows:5,placeholder:"每行输入一个图片URL"},null,8,["modelValue"]),(0,l.Lk)("div",de,[(0,l.bF)(u,{type:"primary",onClick:r.uploadBatchUrls,loading:r.uploading},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(f)]),_:1}),a[21]||(a[21]=(0,l.eW)(" 批量上传 "))]),_:1,__:[21]},8,["onClick","loading"]),(0,l.bF)(u,{onClick:a[5]||(a[5]=e=>r.form.batchUrls="")},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[(0,l.bF)(g)]),_:1}),a[22]||(a[22]=(0,l.eW)(" 清空 "))]),_:1,__:[22]})])]),_:1})],64)):(0,l.Q3)("",!0)]),_:1},8,["model"]),(0,l.bF)(_,{modelValue:r.previewVisible,"onUpdate:modelValue":a[6]||(a[6]=e=>r.previewVisible=e),title:"图片预览",width:"600px"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",ue,[(0,l.Lk)("img",{src:r.previewUrl,alt:"Preview"},null,8,ge)])]),_:1},8,["modelValue"]),(0,l.bF)(_,{modelValue:r.showCategoryDialog,"onUpdate:modelValue":a[9]||(a[9]=e=>r.showCategoryDialog=e),title:"添加图片分类",width:"500px"},{footer:(0,l.k6)(()=>[(0,l.Lk)("span",pe,[(0,l.bF)(u,{onClick:a[8]||(a[8]=e=>r.showCategoryDialog=!1)},{default:(0,l.k6)(()=>a[23]||(a[23]=[(0,l.eW)("取消")])),_:1,__:[23]}),(0,l.bF)(u,{type:"primary",onClick:r.addCategory,loading:r.addingCategory},{default:(0,l.k6)(()=>a[24]||(a[24]=[(0,l.eW)(" 确认 ")])),_:1,__:[24]},8,["onClick","loading"])])]),default:(0,l.k6)(()=>[(0,l.bF)(b,{model:r.categoryForm,"label-width":"100px",ref:"categoryFormRef"},{default:(0,l.k6)(()=>[(0,l.bF)(p,{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},{default:(0,l.k6)(()=>[(0,l.bF)(h,{modelValue:r.categoryForm.name,"onUpdate:modelValue":a[7]||(a[7]=e=>r.categoryForm.name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}t(4114);var me=t(4335),ke={name:"ImageUploader",components:{PlusIcon:Y.Plus,Upload:Y.Upload,Link:Y.Link,DeleteIcon:Y.Delete},emits:["upload-success"],setup(e,{emit:a}){const t=(0,q.KR)(null),r=(0,q.KR)(null),o=(0,q.KR)([]),i=(0,q.KR)(!1),n=(0,q.KR)(""),s=(0,q.KR)(!1),c=(0,q.KR)(!1),d=(0,q.KR)("file"),u=(0,q.KR)([]),g=(0,q.KR)(!1),p=(0,q.Kh)({categoryId:"",imageUrl:"",batchUrls:""}),f=(0,q.Kh)({name:""}),m=(0,l.EW)(()=>"http://8.148.21.21:3000/api/images/upload"),k=(0,l.EW)(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),v=(0,l.EW)(()=>({category_id:p.categoryId})),y=async()=>{try{const e=await ee.Cb.getCategories();o.value=e.data.data,o.value.length>0&&!p.categoryId&&(p.categoryId=o.value[0].id)}catch(e){console.error("获取图片分类失败:",e),J.nk.error("获取图片分类失败")}},h=async()=>{if(f.name.trim())try{c.value=!0,await ee.Cb.addCategory({name:f.name.trim()}),J.nk.success("分类添加成功"),s.value=!1,f.name="",await y()}catch(e){console.error("添加分类失败:",e),J.nk.error(e.response?.data?.message||"添加分类失败")}finally{c.value=!1}else J.nk.warning("请输入分类名称")},b=()=>{J.nk.warning("一次最多上传10张图片")},_=e=>{if(!p.categoryId)return J.nk.warning("请先选择图片分类"),!1;const a=/^image\/(jpeg|png|gif|jpg)$/.test(e.type);if(!a)return J.nk.error("只能上传JPG/PNG/GIF格式的图片"),!1;const t=e.size/1024/1024<5;return t?(u.value.push(e),!0):(J.nk.error("图片大小不能超过5MB"),!1)},w=()=>{t.value&&t.value.submit()},F=async()=>{if(p.categoryId)if(p.imageUrl)try{g.value=!0;const e=await me.A.post("http://8.148.21.21:3000/api/images/upload-by-url",{url:p.imageUrl,category_id:p.categoryId},{headers:k.value});if(e.data.error)return void J.nk.error(e.data.message||"URL上传失败");J.nk.success("图片URL上传成功"),p.imageUrl="",a("upload-success",e.data.data)}catch(e){console.error("URL上传失败:",e),J.nk.error(e.response?.data?.message||"URL上传失败")}finally{g.value=!1}else J.nk.warning("请输入图片URL");else J.nk.warning("请先选择图片分类")},C=async()=>{if(!p.categoryId)return void J.nk.warning("请先选择图片分类");if(!p.batchUrls)return void J.nk.warning("请输入图片URL");const e=p.batchUrls.split("\n").filter(e=>e.trim());if(0!==e.length)try{g.value=!0;const t=await me.A.post("http://8.148.21.21:3000/api/images/upload-batch-urls",{urls:e,category_id:p.categoryId},{headers:k.value});if(t.data.error)return void J.nk.error(t.data.message||"批量URL上传失败");J.nk.success(`成功上传${t.data.data.length}张图片`),p.batchUrls="",a("upload-success",t.data.data)}catch(t){console.error("批量URL上传失败:",t),J.nk.error(t.response?.data?.message||"批量URL上传失败")}finally{g.value=!1}else J.nk.warning("没有有效的URL地址")},I=e=>{n.value=e.url,i.value=!0},L=e=>{const a=u.value.indexOf(e);-1!==a&&u.value.splice(a,1)},U=e=>{e.error?J.nk.error(e.message||"上传失败"):(J.nk.success("图片上传成功"),a("upload-success",e.data))},R=e=>{console.error("上传图片失败:",e),J.nk.error("上传图片失败")},V=()=>{t.value&&t.value.clearFiles(),u.value=[]},x=()=>{if(!p.categoryId)return void J.nk.warning("请先选择分类");const e=o.value.find(e=>e.id===p.categoryId);e?e.image_count>0?J.nk.error(`无法删除分类"${e.name}"，该分类下还有 ${e.image_count} 张图片`):Z.s.confirm(`确定要删除分类"${e.name}"吗？删除后无法恢复。`,"删除分类",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{A(p.categoryId)}).catch(()=>{}):J.nk.warning("未找到该分类")},A=async e=>{try{await ee.Cb.deleteCategory(e),J.nk.success("分类删除成功"),p.categoryId="",await y()}catch(a){console.error("删除分类失败:",a);const e=a.response?.data?.message||"删除分类失败";J.nk.error(e)}},D=e=>{const a=o.value.find(a=>a.id===e);return a&&0===a.image_count};return(0,l.sV)(()=>{y()}),{uploadRef:t,categoryFormRef:r,categories:o,form:p,categoryForm:f,previewVisible:i,previewUrl:n,showCategoryDialog:s,addingCategory:c,uploadUrl:m,uploadHeaders:k,uploadData:v,uploadType:d,fileList:u,uploading:g,fetchCategories:y,addCategory:h,handleExceed:b,beforeUpload:_,handlePreview:I,handleRemove:L,handleSuccess:U,handleError:R,clearUpload:V,submitUpload:w,uploadByUrl:F,uploadBatchUrls:C,confirmDeleteCategory:x,canDeleteCategory:D}}},ve=t(6262);const ye=(0,ve.A)(ke,[["render",fe],["__scopeId","data-v-d2d41c10"]]);var he=ye,be={name:"ImagesPage",components:{ImageUploader:he,View:Y.View,Delete:Y.Delete,Download:Y.Download,Document:Y.Document,RefreshIcon:Y.Refresh,Filter:Y.Filter,ArrowDown:Y.ArrowDown,ArrowUp:Y.ArrowUp,Picture:Y.Picture,Close:Y.Close,DocumentCopy:Y.DocumentCopy},setup(){const e=(0,q.KR)(!1),a=(0,q.KR)([]),t=(0,q.KR)([]),r=(0,q.KR)(!1),o=(0,q.KR)(""),i=(0,q.KR)(null),n=(0,q.KR)(null),s=(0,q.KR)(!1),c=(0,q.Kh)({categoryId:""}),d=(0,l.EW)(()=>""!==c.categoryId),u=(0,q.Kh)({page:1,limit:24,total:0}),g=e=>{c.categoryId=e,u.page=1,k()},p=async()=>{try{const e=await ee.Cb.getCategories();t.value=e.data.data}catch(e){console.error("获取图片分类失败:",e),J.nk.error("获取图片分类失败")}},f=()=>{if(!c.categoryId)return void J.nk.warning("请先选择要删除的分类");const e=t.value.find(e=>e.id===c.categoryId);e?e.image_count>0?Z.s.confirm(`该分类"${e.name}"下有 ${e.image_count} 张图片，删除分类将同时删除该分类下的所有图片，是否继续？`,"删除分类及图片",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}).then(()=>{m(c.categoryId,!0)}).catch(()=>{}):Z.s.confirm(`确定要删除分类"${e.name}"吗？删除后无法恢复。`,"删除分类",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{m(c.categoryId,!1)}).catch(()=>{}):J.nk.warning("未找到该分类")},m=async(a,t=!1)=>{try{e.value=!0,await ee.Cb.deleteCategory(a,{deleteImages:t}),J.nk.success(t?"分类及其图片已删除成功":"分类删除成功"),c.categoryId="",await p(),await k()}catch(l){console.error("删除分类失败:",l);const e=l.response?.data?.message||"删除分类失败";J.nk.error(e)}finally{e.value=!1}},k=async()=>{e.value=!0;try{const e={page:u.page,limit:u.limit};c.categoryId&&(e.category_id=c.categoryId);const t=await ee.gw.getImages(e);a.value=Array.isArray(t.data.data.images)?t.data.data.images:[],u.total=t.data.data.total||0}catch(t){console.error("获取图片列表失败:",t),J.nk.error("获取图片列表失败"),a.value=[]}finally{e.value=!1}},v=()=>{k(),p()},y=e=>{o.value=e.url,i.value=e,r.value=!0},h=e=>{Z.s.confirm("确定要删除这张图片吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b(e)}).catch(()=>{})},b=async e=>{try{J.nk.success("图片删除成功"),a.value=a.value.filter(a=>a.id!==e.id)}catch(t){console.error("删除图片失败:",t),J.nk.error("删除图片失败")}},_=async e=>{if(!n.value){n.value=e.id;try{await ee.gw.compressImage(e.id),J.nk.success("图片压缩成功");const t=a.value.findIndex(a=>a.id===e.id);-1!==t&&(a.value[t].compressed=!0)}catch(t){console.error("压缩图片失败:",t),J.nk.error("压缩图片失败")}finally{n.value=null}}},w=()=>{navigator.clipboard.writeText(o.value).then(()=>{J.nk.success("URL已复制到剪贴板")}).catch(()=>{J.nk.error("复制失败，请手动复制")})},F=()=>{u.page=1,k()},C=()=>{c.categoryId="",u.page=1,k()},I=()=>{k(),p()},L=e=>{u.limit=e,k()},U=e=>{u.page=e,k()},R=e=>e?e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1048576).toFixed(2)+" MB":"未知",V=e=>{if(!e)return"未知";const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString()},x=e=>{if(!e)return"未分类";const a=t.value.find(a=>a.id===e);return a?a.name:"未知分类"};return(0,l.sV)(()=>{p(),k()}),{loading:e,images:a,categories:t,filter:c,pagination:u,previewVisible:r,previewUrl:o,previewImage:i,compressingId:n,isUploadVisible:s,hasActiveFilters:d,selectCategory:g,handleUploadSuccess:v,handlePreviewImage:y,confirmDelete:h,confirmDeleteCategory:f,deleteCategory:m,compressImage:_,copyUrl:w,filterImages:F,resetFilter:C,refreshImages:I,handleSizeChange:L,handlePageChange:U,formatSize:R,formatDate:V,getCategoryName:x}}};const _e=(0,ve.A)(be,[["render",M],["__scopeId","data-v-08ef8b0c"]]);var we=_e},4114:function(e,a,t){var l=t(6518),r=t(8981),o=t(6198),i=t(4527),n=t(6837),s=t(9039),c=s(function(){return 4294967297!==[].push.call({length:4294967296},1)}),d=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},u=c||!d();l({target:"Array",proto:!0,arity:1,forced:u},{push:function(e){var a=r(this),t=o(a),l=arguments.length;n(t+l);for(var s=0;s<l;s++)a[t]=arguments[s],t++;return i(a,t),t}})},4376:function(e,a,t){var l=t(2195);e.exports=Array.isArray||function(e){return"Array"===l(e)}},4527:function(e,a,t){var l=t(3724),r=t(4376),o=TypeError,i=Object.getOwnPropertyDescriptor,n=l&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=n?function(e,a){if(r(e)&&!i(e,"length").writable)throw new o("Cannot set read only .length");return e.length=a}:function(e,a){return e.length=a}},6279:function(e,a,t){var l=t(6840);e.exports=function(e,a,t){for(var r in a)l(e,r,a[r],t);return e}},6319:function(e,a,t){var l=t(8551),r=t(9539);e.exports=function(e,a,t,o){try{return o?a(l(t)[0],t[1]):a(t)}catch(i){r(e,"throw",i)}}},6837:function(e){var a=TypeError,t=9007199254740991;e.exports=function(e){if(e>t)throw a("Maximum allowed index exceeded");return e}},9462:function(e,a,t){var l=t(9565),r=t(2360),o=t(6699),i=t(6279),n=t(8227),s=t(1181),c=t(5966),d=t(7657).IteratorPrototype,u=t(2529),g=t(9539),p=t(1385),f=n("toStringTag"),m="IteratorHelper",k="WrapForValidIterator",v="normal",y="throw",h=s.set,b=function(e){var a=s.getterFor(e?k:m);return i(r(d),{next:function(){var t=a(this);if(e)return t.nextHandler();if(t.done)return u(void 0,!0);try{var l=t.nextHandler();return t.returnHandlerResult?l:u(l,t.done)}catch(r){throw t.done=!0,r}},return:function(){var t=a(this),r=t.iterator;if(t.done=!0,e){var o=c(r,"return");return o?l(o,r):u(void 0,!0)}if(t.inner)try{g(t.inner.iterator,v)}catch(i){return g(r,y,i)}if(t.openIters)try{p(t.openIters,v)}catch(i){return g(r,y,i)}return r&&g(r,v),u(void 0,!0)}})},_=b(!0),w=b(!1);o(w,f,"Iterator Helper"),e.exports=function(e,a,t){var l=function(l,r){r?(r.iterator=l.iterator,r.next=l.next):r=l,r.type=a?k:m,r.returnHandlerResult=!!t,r.nextHandler=e,r.counter=0,r.done=!1,h(this,r)};return l.prototype=a?_:w,l}}}]);
//# sourceMappingURL=747.ad5d4fe0.js.map