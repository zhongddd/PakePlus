"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[911],{1042:function(e,t,a){a.d(t,{A:function(){return S}});var n=a(641),r=a(33);const l={class:"workflow-tester"},o={class:"api-info"},s={key:0},i={key:1},u={key:2},c={class:"input-section"},d={class:"button-group"},p={key:0,class:"async-status"},k={key:0},f=["href"],g={class:"async-actions"},y={key:1,class:"execution-result"},v=["href"],w={class:"card-header"},b={class:"output-text"};function _(e,t,a,_,h,m){const I=(0,n.g2)("el-alert"),T=(0,n.g2)("el-input"),x=(0,n.g2)("el-button"),C=(0,n.g2)("el-divider"),S=(0,n.g2)("el-tag"),A=(0,n.g2)("el-descriptions-item"),W=(0,n.g2)("el-descriptions"),z=(0,n.g2)("el-card"),E=(0,n.g2)("el-collapse-item"),L=(0,n.g2)("el-collapse"),X=(0,n.g2)("el-empty");return(0,n.uX)(),(0,n.CE)("div",l,[t[12]||(t[12]=(0,n.Lk)("h3",null,"Coze工作流测试",-1)),(0,n.Lk)("div",o,[a.apiSettings&&a.apiSettings.cozeApiToken?((0,n.uX)(),(0,n.Wv)(I,{key:0,type:"info",closable:!1,"show-icon":""},{default:(0,n.k6)(()=>[t[2]||(t[2]=(0,n.eW)(" 当前使用配置： ")),a.apiSettings.cozeApiToken?((0,n.uX)(),(0,n.CE)("span",s,"Token: "+(0,r.v_)(_.maskToken(a.apiSettings.cozeApiToken)),1)):(0,n.Q3)("",!0),a.apiSettings.workflowId?((0,n.uX)(),(0,n.CE)("span",i,"，WorkflowID: "+(0,r.v_)(a.apiSettings.workflowId),1)):(0,n.Q3)("",!0),a.apiSettings.botId?((0,n.uX)(),(0,n.CE)("span",u,"，BotID: "+(0,r.v_)(a.apiSettings.botId),1)):(0,n.Q3)("",!0)]),_:1,__:[2]})):(0,n.Q3)("",!0)]),(0,n.Lk)("div",c,[t[5]||(t[5]=(0,n.Lk)("div",{class:"label"},"输入关键词：",-1)),(0,n.bF)(T,{modelValue:_.inputText,"onUpdate:modelValue":t[0]||(t[0]=e=>_.inputText=e),type:"textarea",rows:4,placeholder:"请输入关键词，例如: 影刀RPA代做"},null,8,["modelValue"]),(0,n.Lk)("div",d,[(0,n.bF)(x,{type:"primary",onClick:_.runWorkflow,loading:_.loading,disabled:!a.apiSettings||!a.apiSettings.cozeApiToken||!a.apiSettings.workflowId},{default:(0,n.k6)(()=>t[3]||(t[3]=[(0,n.eW)(" 执行工作流 ")])),_:1,__:[3]},8,["onClick","loading","disabled"]),(0,n.bF)(x,{onClick:_.clearForm},{default:(0,n.k6)(()=>t[4]||(t[4]=[(0,n.eW)("清空")])),_:1,__:[4]},8,["onClick"])])]),(0,n.bF)(C,{"content-position":"center"},{default:(0,n.k6)(()=>t[6]||(t[6]=[(0,n.eW)("执行结果")])),_:1,__:[6]}),_.asyncExecuteInfo.executeId?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.bF)(I,{type:"info",closable:!1,"show-icon":""},{default:(0,n.k6)(()=>[t[7]||(t[7]=(0,n.Lk)("p",null,"异步工作流执行中...",-1)),(0,n.Lk)("p",null,"执行ID: "+(0,r.v_)(_.asyncExecuteInfo.executeId),1),(0,n.Lk)("p",null,"开始时间: "+(0,r.v_)(_.formatTime(_.asyncExecuteInfo.startTime)),1),_.asyncExecuteInfo.debugUrl?((0,n.uX)(),(0,n.CE)("p",k,[(0,n.Lk)("a",{href:_.asyncExecuteInfo.debugUrl,target:"_blank"},"查看调试页面",8,f)])):(0,n.Q3)("",!0)]),_:1,__:[7]}),(0,n.Lk)("div",g,[(0,n.bF)(x,{type:"primary",onClick:_.checkAsyncResult,loading:_.checkingResult},{default:(0,n.k6)(()=>t[8]||(t[8]=[(0,n.eW)(" 检查执行结果 ")])),_:1,__:[8]},8,["onClick","loading"]),(0,n.bF)(x,{onClick:_.cancelAsyncCheck},{default:(0,n.k6)(()=>t[9]||(t[9]=[(0,n.eW)("取消")])),_:1,__:[9]},8,["onClick"])])])):(0,n.Q3)("",!0),_.result?((0,n.uX)(),(0,n.CE)("div",y,[(0,n.bF)(W,{title:"执行信息",column:1,border:""},{default:(0,n.k6)(()=>[(0,n.bF)(A,{label:"状态"},{default:(0,n.k6)(()=>[(0,n.bF)(S,{type:_.result.isCompleted?"success":"warning"},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(_.result.status||"未知"),1)]),_:1},8,["type"])]),_:1}),_.result.createTime?((0,n.uX)(),(0,n.Wv)(A,{key:0,label:"开始时间"},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(_.formatTime(1e3*_.result.createTime)),1)]),_:1})):(0,n.Q3)("",!0),_.result.updateTime?((0,n.uX)(),(0,n.Wv)(A,{key:1,label:"结束时间"},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(_.formatTime(1e3*_.result.updateTime)),1)]),_:1})):(0,n.Q3)("",!0),_.result.debugUrl?((0,n.uX)(),(0,n.Wv)(A,{key:2,label:"调试链接"},{default:(0,n.k6)(()=>[(0,n.Lk)("a",{href:_.result.debugUrl,target:"_blank"},"打开调试页面",8,v)]),_:1})):(0,n.Q3)("",!0)]),_:1}),_.result.parsedOutput?((0,n.uX)(),(0,n.Wv)(z,{key:0,class:"result-content"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",w,[t[11]||(t[11]=(0,n.Lk)("span",null,"输出结果",-1)),(0,n.bF)(x,{size:"small",onClick:_.copyOutput},{default:(0,n.k6)(()=>t[10]||(t[10]=[(0,n.eW)("复制")])),_:1,__:[10]},8,["onClick"])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",b,(0,r.v_)(_.result.parsedOutput),1)]),_:1})):(0,n.Q3)("",!0),_.result.output?((0,n.uX)(),(0,n.Wv)(L,{key:1,class:"raw-output"},{default:(0,n.k6)(()=>[(0,n.bF)(E,{title:"原始输出"},{default:(0,n.k6)(()=>[(0,n.Lk)("pre",null,(0,r.v_)(_.result.output),1)]),_:1})]),_:1})):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),_.asyncExecuteInfo.executeId||_.result?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(X,{key:2,description:"还未执行工作流"})),_.error?((0,n.uX)(),(0,n.Wv)(I,{key:3,type:"error",closable:!0,"show-icon":"",onClose:t[1]||(t[1]=e=>_.error=""),style:{"margin-top":"15px"}},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(_.error),1)]),_:1})):(0,n.Q3)("",!0)])}var h=a(953),m=a(163),I=a(4335),T={name:"CozeWorkflowTester",props:{apiSettings:{type:Object,required:!0,default:()=>({})}},emits:["result"],setup(e,{emit:t}){const a=(0,h.KR)(""),n=(0,h.KR)(!1),r=(0,h.KR)(!1),l=(0,h.KR)(""),o=(0,h.KR)(null),s=(0,h.Kh)({executeId:"",workflowId:"",startTime:null,debugUrl:""});let i=null;const u=e=>{if(!e)return"-";const t=new Date(e);return`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`},c=e=>e?e.length<=10?e:e.substring(0,5)+"..."+e.substring(e.length-5):"",d=async()=>{if(a.value.trim())if(e.apiSettings&&e.apiSettings.cozeApiToken&&e.apiSettings.workflowId)try{n.value=!0,l.value="";const t={headers:{"X-Coze-Settings":JSON.stringify({cozeApiToken:e.apiSettings.cozeApiToken,cozeWorkflowId:e.apiSettings.workflowId,cozeBotId:e.apiSettings.botId,useAsyncMode:!0})}},r=await I.A.post("/api/test-coze-api/generate-description",{keywords:a.value,input:a.value,useAsyncMode:!0},t);if(r.data.error)throw new Error(r.data.message||"执行工作流失败");r.data.data.isAsync&&r.data.data.executeId?(s.executeId=r.data.data.executeId,s.workflowId=r.data.data.workflowId,s.startTime=(new Date).getTime(),s.debugUrl=r.data.data.debugUrl,m.nk.success("工作流开始异步执行"),setTimeout(()=>{p()},5e3)):(o.value=r.data.data,f())}catch(t){console.error("执行工作流出错:",t),l.value=t.message||"执行工作流失败"}finally{n.value=!1}else l.value="请先配置Coze API设置";else m.nk.warning("请输入关键词")},p=async()=>{if(s.executeId&&s.workflowId)try{r.value=!0;const a={headers:{"X-Coze-Settings":JSON.stringify({cozeApiToken:e.apiSettings.cozeApiToken,cozeWorkflowId:e.apiSettings.workflowId,cozeBotId:e.apiSettings.botId})}},n=await I.A.get(`/api/test-coze-api/async-result/${s.workflowId}/${s.executeId}`,a);if(n.data.error)throw new Error(n.data.message||"查询执行结果失败");o.value=n.data.data,o.value.isCompleted?(m.nk.success("工作流执行完成"),f(),t("result",o.value)):(m.nk.info(`工作流执行中，状态: ${o.value.status}`),i=setTimeout(p,1e4))}catch(a){console.error("检查异步结果失败:",a),l.value=a.message||"检查执行结果失败"}finally{r.value=!1}else m.nk.warning("没有正在执行的异步工作流")},k=()=>{i&&(clearTimeout(i),i=null),f(),m.nk.info("已取消异步工作流检查")},f=()=>{s.executeId="",s.workflowId="",s.startTime=null,s.debugUrl=""},g=async()=>{if(o.value&&o.value.parsedOutput)try{await navigator.clipboard.writeText(o.value.parsedOutput),m.nk.success("已复制到剪贴板")}catch(e){console.error("复制失败:",e),m.nk.error("复制失败")}},y=()=>{a.value="",o.value=null,l.value="",f()};return{inputText:a,loading:n,checkingResult:r,result:o,asyncExecuteInfo:s,error:l,runWorkflow:d,checkAsyncResult:p,cancelAsyncCheck:k,clearForm:y,copyOutput:g,formatTime:u,maskToken:c}}},x=a(6262);const C=(0,x.A)(T,[["render",_],["__scopeId","data-v-1a8587c9"]]);var S=C},4114:function(e,t,a){var n=a(6518),r=a(8981),l=a(6198),o=a(4527),s=a(6837),i=a(9039),u=i(function(){return 4294967297!==[].push.call({length:4294967296},1)}),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},d=u||!c();n({target:"Array",proto:!0,arity:1,forced:d},{push:function(e){var t=r(this),a=l(t),n=arguments.length;s(a+n);for(var i=0;i<n;i++)t[a]=arguments[i],a++;return o(t,a),a}})},4376:function(e,t,a){var n=a(2195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},4527:function(e,t,a){var n=a(3724),r=a(4376),l=TypeError,o=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(r(e)&&!o(e,"length").writable)throw new l("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},6837:function(e){var t=TypeError,a=9007199254740991;e.exports=function(e){if(e>a)throw t("Maximum allowed index exceeded");return e}}}]);
//# sourceMappingURL=911.1bae7e86.js.map