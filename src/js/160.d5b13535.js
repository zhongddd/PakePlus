"use strict";(self["webpackChunkclient"]=self["webpackChunkclient"]||[]).push([[160],{9160:function(e,a,t){t.r(a),t.d(a,{default:function(){return I}});var r=t(641),o=t(33);const l={class:"publish-task-pool"},s={class:"card-header"},n={class:"task-pool"},d={key:0,class:"empty-tasks"},i={key:0},u={key:0,class:"category-hint"},c={style:{display:"flex","align-items":"center"}},k={class:"dialog-footer"},m={key:0,class:"task-detail"},g={key:0},p={class:"dialog-footer"};function _(e,a,t,_,b,y){const f=(0,r.g2)("el-button"),h=(0,r.g2)("el-empty"),w=(0,r.g2)("el-table-column"),F=(0,r.g2)("el-tag"),v=(0,r.g2)("el-table"),I=(0,r.g2)("el-card"),T=(0,r.g2)("el-radio"),C=(0,r.g2)("el-radio-group"),W=(0,r.g2)("el-form-item"),V=(0,r.g2)("el-input"),E=(0,r.g2)("el-option"),D=(0,r.g2)("el-select"),N=(0,r.g2)("el-input-number"),S=(0,r.g2)("el-checkbox"),x=(0,r.g2)("el-checkbox-group"),$=(0,r.g2)("el-form"),L=(0,r.g2)("el-dialog"),R=(0,r.g2)("el-descriptions-item"),z=(0,r.g2)("el-descriptions"),A=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",l,[(0,r.bF)(I,{class:"box-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",s,[a[16]||(a[16]=(0,r.Lk)("h2",null,"发布任务池",-1)),(0,r.bF)(f,{type:"primary",onClick:a[0]||(a[0]=e=>_.taskFormVisible=!0)},{default:(0,r.k6)(()=>a[15]||(a[15]=[(0,r.eW)("创建发布任务")])),_:1,__:[15]})])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",n,[0===_.tasks.length?((0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(h,{description:"暂无任务"})])):(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{key:1,data:_.tasks,style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(w,{label:"任务ID",prop:"id",width:"80"}),(0,r.bF)(w,{label:"关键词",width:"200"},{default:(0,r.k6)(e=>[e.row.keywords?((0,r.uX)(),(0,r.CE)("span",i,(0,o.v_)(e.row.keywords),1)):e.row.keyword_category_name?((0,r.uX)(),(0,r.Wv)(F,{key:1,type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)("从 "+(0,o.v_)(e.row.keyword_category_name)+" 分类随机选择",1)]),_:2},1024)):((0,r.uX)(),(0,r.Wv)(F,{key:2,type:"info"},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("未指定关键词")])),_:1,__:[17]}))]),_:1}),(0,r.bF)(w,{label:"店铺",width:"120"},{default:(0,r.k6)(e=>[(0,r.eW)((0,o.v_)(e.row.shop_name||_.getShopName(e.row.shopId||e.row.shop_id)),1)]),_:1}),(0,r.bF)(w,{label:"数量",width:"100"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",null,(0,o.v_)(e.row.completedCount||e.row.completed_count||0)+"/"+(0,o.v_)(e.row.count),1)]),_:1}),(0,r.bF)(w,{label:"图片分类",width:"150"},{default:(0,r.k6)(e=>[(0,r.eW)((0,o.v_)(e.row.category_name||_.getCategoryName(e.row.categoryId||e.row.category_id)),1)]),_:1}),(0,r.bF)(w,{label:"创建时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,o.v_)(_.formatTime(e.row.createTime||e.row.create_time)),1)]),_:1}),(0,r.bF)(w,{label:"状态",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)(F,{type:_.getStatusType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(w,{label:"操作",width:"260"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{size:"small",type:"primary",onClick:a=>_.viewTaskDetail(e.row),disabled:"PENDING"===e.row.status},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)(" 查看 ")])),_:2,__:[18]},1032,["onClick","disabled"]),(0,r.bF)(f,{size:"small",type:"danger",onClick:a=>_.cancelTask(e.row),disabled:["COMPLETED","CANCELED","FAILED"].includes(e.row.status)},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)(" 取消 ")])),_:2,__:[19]},1032,["onClick","disabled"]),(0,r.bF)(f,{size:"small",type:"warning",onClick:a=>_.deleteTask(e.row),disabled:"RUNNING"===e.row.status},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)(" 删除 ")])),_:2,__:[20]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[A,_.loading]])])]),_:1}),(0,r.bF)(L,{modelValue:_.taskFormVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>_.taskFormVisible=e),title:"创建发布任务",width:"50%"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",k,[(0,r.bF)(f,{onClick:a[11]||(a[11]=e=>_.taskFormVisible=!1)},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("取消")])),_:1,__:[35]}),(0,r.bF)(f,{onClick:_.resetTaskForm},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("重置")])),_:1,__:[36]},8,["onClick"]),(0,r.bF)(f,{type:"primary",onClick:_.createTask,loading:_.creating},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("创建任务")])),_:1,__:[37]},8,["onClick","loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)($,{model:_.taskForm,rules:_.taskRules,ref:"taskFormRef","label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(W,{label:"关键词来源"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:_.keywordSource,"onUpdate:modelValue":a[1]||(a[1]=e=>_.keywordSource=e)},{default:(0,r.k6)(()=>[(0,r.bF)(T,{label:"manual"},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)("手动输入关键词")])),_:1,__:[21]}),(0,r.bF)(T,{label:"category"},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("从关键词分类中随机选取")])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),"manual"===_.keywordSource?((0,r.uX)(),(0,r.Wv)(W,{key:0,label:"关键词",prop:"keywords"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:_.taskForm.keywords,"onUpdate:modelValue":a[2]||(a[2]=e=>_.taskForm.keywords=e),placeholder:"请输入商品关键词，多个关键词用逗号分隔"},null,8,["modelValue"])]),_:1})):((0,r.uX)(),(0,r.Wv)(W,{key:1,label:"关键词分类",prop:"keywordCategoryId"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:_.taskForm.keywordCategoryId,"onUpdate:modelValue":a[3]||(a[3]=e=>_.taskForm.keywordCategoryId=e),placeholder:"请选择关键词分类"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.keywordCategories,e=>((0,r.uX)(),(0,r.Wv)(E,{key:e.id,label:`${e.name} (${e.keyword_count}个关键词)`,value:e.id,disabled:0===e.keyword_count},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),_.taskForm.keywordCategoryId?((0,r.uX)(),(0,r.CE)("div",u,a[23]||(a[23]=[(0,r.Lk)("p",null,"系统将为每个商品从此分类中随机选择关键词",-1)]))):(0,r.Q3)("",!0)]),_:1})),(0,r.bF)(W,{label:"发布数量",prop:"count"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:_.taskForm.count,"onUpdate:modelValue":a[4]||(a[4]=e=>_.taskForm.count=e),min:1,max:20,"controls-position":"right"},null,8,["modelValue"]),a[24]||(a[24]=(0,r.Lk)("span",{class:"count-tip"},"（最多20个）",-1))]),_:1,__:[24]}),(0,r.bF)(W,{label:"图片分类",prop:"categoryId"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:_.taskForm.categoryId,"onUpdate:modelValue":a[5]||(a[5]=e=>_.taskForm.categoryId=e),placeholder:"请选择图片分类"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.categories,e=>((0,r.uX)(),(0,r.Wv)(E,{key:e.id,label:`${e.name} (${e.image_count}张)`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(W,{label:"每个商品图片数量",prop:"imagesPerProduct"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",c,[(0,r.bF)(N,{modelValue:_.taskForm.minImages,"onUpdate:modelValue":a[6]||(a[6]=e=>_.taskForm.minImages=e),min:1,max:9,"controls-position":"right"},null,8,["modelValue"]),a[25]||(a[25]=(0,r.Lk)("span",{style:{margin:"0 10px"}},"至",-1)),(0,r.bF)(N,{modelValue:_.taskForm.maxImages,"onUpdate:modelValue":a[7]||(a[7]=e=>_.taskForm.maxImages=e),min:1,max:9,"controls-position":"right"},null,8,["modelValue"]),a[26]||(a[26]=(0,r.Lk)("span",{class:"count-tip"},"（每个商品随机选取图片数量）",-1))])]),_:1}),(0,r.bF)(W,{label:"店铺",prop:"shopId"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:_.taskForm.shopId,"onUpdate:modelValue":a[8]||(a[8]=e=>_.taskForm.shopId=e),placeholder:"请选择店铺"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.shops,e=>((0,r.uX)(),(0,r.Wv)(E,{key:e.id,label:e.shop_name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(W,{label:"商品价格",prop:"price"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:_.taskForm.price,"onUpdate:modelValue":a[9]||(a[9]=e=>_.taskForm.price=e),min:.01,precision:2,step:.01,"controls-position":"right"},null,8,["modelValue"]),a[27]||(a[27]=(0,r.Lk)("span",{class:"price-tip"},"单位：元",-1))]),_:1,__:[27]}),(0,r.bF)(W,{label:"商品服务"},{default:(0,r.k6)(()=>[(0,r.bF)(x,{modelValue:_.taskForm.services,"onUpdate:modelValue":a[10]||(a[10]=e=>_.taskForm.services=e)},{default:(0,r.k6)(()=>[(0,r.bF)(S,{label:"SDR"},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("七天无理由退货")])),_:1,__:[28]}),(0,r.bF)(S,{label:"NFR"},{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("描述不符包邮退")])),_:1,__:[29]}),(0,r.bF)(S,{label:"VNR"},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("描述不符全额退（虚拟类）")])),_:1,__:[30]}),(0,r.bF)(S,{label:"FD_10MS"},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("10分钟极速发货（虚拟类）")])),_:1,__:[31]}),(0,r.bF)(S,{label:"FD_24HS"},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)("24小时极速发货")])),_:1,__:[32]}),(0,r.bF)(S,{label:"FD_48HS"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("48小时极速发货")])),_:1,__:[33]}),(0,r.bF)(S,{label:"FD_GPA"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("正品保障")])),_:1,__:[34]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,r.bF)(L,{modelValue:_.taskDetailVisible,"onUpdate:modelValue":a[14]||(a[14]=e=>_.taskDetailVisible=e),title:"任务详情",width:"70%"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",p,[(0,r.bF)(f,{onClick:a[13]||(a[13]=e=>_.taskDetailVisible=!1)},{default:(0,r.k6)(()=>a[40]||(a[40]=[(0,r.eW)("关闭")])),_:1,__:[40]})])]),default:(0,r.k6)(()=>[_.currentTask?((0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(z,{title:"任务信息",column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(R,{label:"任务ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.currentTask.id),1)]),_:1}),(0,r.bF)(R,{label:"关键词"},{default:(0,r.k6)(()=>[_.currentTask.keywords?((0,r.uX)(),(0,r.CE)("span",g,(0,o.v_)(_.currentTask.keywords),1)):_.currentTask.keyword_category_name?((0,r.uX)(),(0,r.Wv)(F,{key:1,type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)("从 "+(0,o.v_)(_.currentTask.keyword_category_name)+" 分类随机选择",1)]),_:1})):((0,r.uX)(),(0,r.Wv)(F,{key:2,type:"info"},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("未指定关键词")])),_:1,__:[38]}))]),_:1}),(0,r.bF)(R,{label:"店铺"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.currentTask.shop_name||_.getShopName(_.currentTask.shopId||_.currentTask.shop_id)),1)]),_:1}),(0,r.bF)(R,{label:"发布数量"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.currentTask.count),1)]),_:1}),(0,r.bF)(R,{label:"已完成"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.currentTask.completedCount||_.currentTask.completed_count||0),1)]),_:1}),(0,r.bF)(R,{label:"商品图片数量"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)((_.currentTask.minImages||_.currentTask.min_images)===(_.currentTask.maxImages||_.currentTask.max_images)?_.currentTask.minImages||_.currentTask.min_images:`${_.currentTask.minImages||_.currentTask.min_images||1}~${_.currentTask.maxImages||_.currentTask.max_images||5}`)+" 张 ",1)]),_:1}),(0,r.bF)(R,{label:"图片分类"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.currentTask.category_name||_.getCategoryName(_.currentTask.categoryId||_.currentTask.category_id)),1)]),_:1}),(0,r.bF)(R,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.formatTime(_.currentTask.createTime||_.currentTask.create_time)),1)]),_:1}),(0,r.bF)(R,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{type:_.getStatusType(_.currentTask.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(_.getStatusText(_.currentTask.status)),1)]),_:1},8,["type"])]),_:1})]),_:1}),a[39]||(a[39]=(0,r.Lk)("h4",null,"发布记录",-1)),(0,r.bF)(v,{data:_.currentTask.publishLogs||[],stripe:"",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(w,{label:"序号",type:"index",width:"60"}),(0,r.bF)(w,{label:"商品标题",prop:"title","min-width":"200"}),(0,r.bF)(w,{label:"使用关键词",prop:"keyword",width:"150"}),(0,r.bF)(w,{label:"商品ID",prop:"productId",width:"120"}),(0,r.bF)(w,{label:"发布时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,o.v_)(_.formatTime(e.row.publishTime)),1)]),_:1}),(0,r.bF)(w,{label:"状态",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)(F,{type:"success"===e.row.status?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)("success"===e.row.status?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])):(0,r.Q3)("",!0)]),_:1},8,["modelValue"])])}t(8111),t(116);var b=t(953),y=t(163),f=t(7918),h=t(4783),w={name:"PublishTaskPool",setup(){const e=(0,h.k)(),a=(0,b.KR)(null),t=(0,b.KR)(!1),o=(0,b.Kh)({keywords:"",keywordCategoryId:"",count:1,categoryId:"",shopId:"",price:9.9,minImages:1,maxImages:5,services:["SDR","NFR"]}),l=(0,b.KR)("manual"),s={keywords:[{required:!0,message:"请输入商品关键词",trigger:"blur"}],keywordCategoryId:[{required:!0,message:"请选择关键词分类",trigger:"change"}],count:[{required:!0,message:"请输入发布数量",trigger:"blur"},{type:"number",min:1,message:"发布数量必须大于0",trigger:"blur"}],categoryId:[{required:!0,message:"请选择图片分类",trigger:"change"}],shopId:[{required:!0,message:"请选择店铺",trigger:"change"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}]},n=(0,b.KR)(!1),d=(0,b.KR)(!1),i=(0,b.KR)([]),u=(0,b.KR)([]),c=(0,b.KR)([]),k=(0,b.KR)([]),m=(0,b.KR)(!1),g=(0,b.KR)(null);let p=null;const _=async()=>{try{const a=await fetch("/api/keywordCategories",{method:"GET",headers:{Authorization:`Bearer ${e.token}`}}),t=await a.json();!t.error&&t.data?c.value=t.data:y.nk.error(`获取关键词分类失败: ${t.message||"未知错误"}`)}catch(a){console.error("获取关键词分类异常:",a),y.nk.error("网络异常，请稍后重试")}},w=async()=>{try{const a=await fetch("/api/shops",{method:"GET",headers:{Authorization:`Bearer ${e.token}`}}),t=await a.json();!t.error&&t.data?(i.value=t.data,1===i.value.length&&(o.shopId=i.value[0].id)):y.nk.error(`获取店铺列表失败: ${t.message||"未知错误"}`)}catch(a){console.error("获取店铺列表异常:",a),y.nk.error("网络异常，请稍后重试")}},F=async()=>{try{const a=await fetch("/api/image-categories",{headers:{Authorization:`Bearer ${e.token}`}});if(a.ok){const e=await a.json();!e.error&&e.data?u.value=e.data:y.nk.error("获取图片分类失败")}else y.nk.error("获取图片分类失败")}catch(a){console.error("获取图片分类异常:",a),y.nk.error("网络异常，请稍后重试")}},v=async()=>{try{n.value=!0;const a=await fetch("/api/publish-tasks",{headers:{Authorization:`Bearer ${e.token}`}});if(a.ok){const e=await a.json();!e.error&&e.data?(k.value=e.data,i.value.length||await w(),u.value.length||await F()):y.nk.error("获取任务列表失败")}else y.nk.error("获取任务列表失败")}catch(a){console.error("获取任务列表异常:",a),y.nk.error("网络异常，请稍后重试")}finally{n.value=!1}},I=async()=>{if(a.value)try{"manual"===l.value?(s.keywords[0].required=!0,s.keywordCategoryId=[]):(s.keywords=[],s.keywordCategoryId=[{required:!0,message:"请选择关键词分类",trigger:"change"}]),await a.value.validate(),d.value=!0;const r=localStorage.getItem("apiSettings");if(!r)return void y.nk.error("请先在设置页面配置Coze API");const n=JSON.parse(r);if(!n.cozeApiToken||!n.cozeWorkflowId)return void y.nk.error("Coze API设置不完整，请先在设置页面完成配置");const i={shopId:o.shopId,price:o.price,minImages:o.minImages,maxImages:o.maxImages,services:o.services.join(","),count:o.count,categoryId:o.categoryId,apiSettings:{cozeApiToken:n.cozeApiToken,cozeWorkflowId:n.cozeWorkflowId,cozeBotId:n.cozeBotId||""}};"manual"===l.value?i.keywords=o.keywords:i.keywordCategoryId=o.keywordCategoryId,console.log("创建任务数据:",JSON.stringify(i,null,2)),console.log("关键词来源:",l.value),console.log("关键词分类ID:",o.keywordCategoryId);const u=await fetch("/api/publish-tasks",{method:"POST",headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(u.ok){const e=await u.json();e.error?y.nk.error(`创建任务失败: ${e.message}`):(y.nk.success("任务创建成功"),t.value=!1,V(),v())}else{const e=await u.json();y.nk.error(`创建任务失败: ${e.message||"未知错误"}`)}}catch(r){console.error("创建任务异常:",r),y.nk.error("创建任务失败，请稍后重试")}finally{d.value=!1}},T=a=>{f.s.confirm(`确定要取消任务 #${a.id} 吗？`,"取消确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await fetch(`/api/publish-tasks/${a.id}/cancel`,{method:"POST",headers:{Authorization:`Bearer ${e.token}`}});if(t.ok){const e=await t.json();e.error?y.nk.error(`取消任务失败: ${e.message}`):(y.nk.success("任务已取消"),v())}else y.nk.error("取消任务失败")}catch(t){console.error("取消任务异常:",t),y.nk.error("网络异常，请稍后重试")}}).catch(()=>{})},C=a=>{f.s.confirm(`确定要删除任务 #${a.id} 吗？此操作无法恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await fetch(`/api/publish-tasks/${a.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e.token}`}});if(t.ok){const e=await t.json();e.error?y.nk.error(`删除任务失败: ${e.message}`):(y.nk.success("任务已删除"),v())}else y.nk.error("删除任务失败")}catch(t){console.error("删除任务异常:",t),y.nk.error("网络异常，请稍后重试")}}).catch(()=>{})},W=async a=>{g.value=a;try{const t=await fetch(`/api/publish-tasks/${a.id}/detail`,{headers:{Authorization:`Bearer ${e.token}`}});if(t.ok){const e=await t.json();!e.error&&e.data?(g.value={...g.value,...e.data},m.value=!0):y.nk.error("获取任务详情失败")}else y.nk.error("获取任务详情失败")}catch(t){console.error("获取任务详情异常:",t),y.nk.error("网络异常，请稍后重试")}},V=()=>{a.value&&a.value.resetFields()},E=e=>{const a=i.value.find(a=>a.id===e);return a?a.shop_name:"未知店铺"},D=e=>{const a=u.value.find(a=>a.id===e);return a?a.name:"未知分类"},N=e=>{if(!e)return"-";const a=new Date(e);return`${a.toLocaleDateString()} ${a.toLocaleTimeString()}`},S=e=>{switch(e){case"RUNNING":return"primary";case"COMPLETED":return"success";case"FAILED":return"danger";case"CANCELED":return"info";default:return"warning"}},x=e=>{switch(e){case"PENDING":return"等待中";case"RUNNING":return"执行中";case"COMPLETED":return"已完成";case"FAILED":return"失败";case"CANCELED":return"已取消";default:return"未知"}},$=()=>{v(),p=setInterval(()=>{v(),m.value&&g.value&&W(g.value)},5e3)};return(0,r.sV)(()=>{w(),F(),_(),v(),$()}),(0,r.xo)(()=>{p&&clearInterval(p)}),{taskFormRef:a,taskForm:o,taskFormVisible:t,taskRules:s,loading:n,creating:d,shops:i,categories:u,keywordCategories:c,keywordSource:l,tasks:k,taskDetailVisible:m,currentTask:g,createTask:I,cancelTask:T,deleteTask:C,viewTaskDetail:W,resetTaskForm:V,getShopName:E,getCategoryName:D,formatTime:N,getStatusType:S,getStatusText:x}}},F=t(6262);const v=(0,F.A)(w,[["render",_],["__scopeId","data-v-5d7ef207"]]);var I=v}}]);
//# sourceMappingURL=160.d5b13535.js.map